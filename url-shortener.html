<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>URL Shortener — MY SUPER TOOLS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="description" content="Robust client-side URL shortener with multiple fallbacks and diagnostics." />
  <style>
    :root{ --bg:#000; --panel:rgba(20,20,30,.9); --cyan:#0ff; --text:#fff; --muted:#9ad7d7 }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:var(--bg);color:var(--text);font-family:Segoe UI, system-ui, -apple-system, "Helvetica Neue", Arial;padding:28px;display:flex;align-items:center;justify-content:center}
    .wrap{width:100%;max-width:880px}
    header{text-align:center;margin-bottom:22px}
    a.back{color:var(--cyan);text-decoration:none;font-weight:600}
    h1{font-size:2.6rem;margin:8px 0 6px;text-shadow:0 0 12px var(--cyan);}
    p.lead{color:var(--muted);margin:0 auto 6px;max-width:760px}

    .card{background:var(--panel);border-radius:14px;padding:20px;border:1px solid rgba(0,200,200,.12);box-shadow:0 0 20px rgba(0,200,200,.08)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    input[type=url]{flex:1 1 520px;padding:12px 14px;border-radius:10px;border:none;font-size:1rem}
    .btn{background:transparent;color:var(--cyan);border:2px solid var(--cyan);padding:10px 18px;border-radius:30px;font-weight:700;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}

    .help{color:#bfe9e9;margin-top:10px}
    .result{margin-top:16px;font-size:1.03rem}
    .result a{color:var(--cyan);font-weight:700}
    .diag{margin-top:12px;font-size:.9rem;color:#d9f7f7;background:rgba(0,0,0,.15);padding:10px;border-radius:8px;border:1px dashed rgba(0,200,200,.06)}

    .history{margin-top:18px}
    .history h4{color:var(--cyan);margin:6px 0}
    .list{display:grid;gap:8px}
    .item{display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,.2);padding:8px;border-radius:8px}
    .mini{color:#c6ffff;font-size:.9rem}

    @media (max-width:640px){h1{font-size:1.8rem} input[type=url]{flex:1 1 200px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="back" href="index.html">&larr; Back to Home</a>
      <h1><i class="fa fa-link"></i> URL Shortener</h1>
      <p class="lead">Shorten long links into clean, shareable URLs.</p>
    </header>

    <section class="card" aria-label="URL shortener">
      <label for="longUrl" class="help">Paste the full URL below. If you omit http/https we'll add https automatically.</label>
      <div class="row" style="margin-top:12px">
        <input id="longUrl" type="url" placeholder="https://example.com/very/long/link" autocomplete="on" inputmode="url" />
        <button id="shortenBtn" class="btn" type="button"><i class="fa fa-magic"></i> Shorten</button>
        <button id="clearBtn" class="btn" type="button" style="border-style:dashed;">Clear</button>
      </div>

      <div id="result" class="result" role="status" aria-live="polite"></div>

      <div id="diag" class="diag" style="display:none"></div>

      <div class="history" aria-live="polite">
        <h4>Recent</h4>
        <div id="historyList" class="list"></div>
      </div>
    </section>
  </div>

  <script>
    const input = document.getElementById('longUrl');
    const btn = document.getElementById('shortenBtn');
    const clearBtn = document.getElementById('clearBtn');
    const result = document.getElementById('result');
    const diag = document.getElementById('diag');
    const historyList = document.getElementById('historyList');
    const STORAGE_KEY = 'urlShortenerHistory_v1';

    const providers = [
      { name: 'is.gd', build: u => `https://is.gd/create.php?format=simple&url=${encodeURIComponent(u)}` },
      { name: 'v.gd', build: u => `https://v.gd/create.php?format=simple&url=${encodeURIComponent(u)}` },
      { name: 'tinyurl', build: u => `https://tinyurl.com/api-create.php?url=${encodeURIComponent(u)}` }
    ];

    function normalizeUrl(raw){
      let u = (raw||'').trim();
      if(!u) return '';
      if(!/^https?:\/\//i.test(u)) u = 'https://' + u;
      try { new URL(u); return u; } catch { return ''; }
    }

    function setWorking(on){
      btn.disabled = on; clearBtn.disabled = on;
      btn.dataset._orig = btn.dataset._orig || btn.innerHTML;
      btn.innerHTML = on ? '<i class="fa fa-circle-notch fa-spin"></i> Working' : btn.dataset._orig;
    }

    function showError(msg, extra){
      result.innerHTML = `❌ ${msg}`;
      if(extra) showDiag(extra);
    }
    function showSuccess(shortUrl, provider){
      result.innerHTML = `✅ Short link: <a href="${shortUrl}" target="_blank" rel="noopener">${shortUrl}</a>
        <div style="margin-top:10px">
          <button class="btn" onclick="copyLink('${shortUrl}')"><i class="fa fa-copy"></i> Copy</button>
          <a class="btn" href="${shortUrl}" target="_blank" rel="noopener">Open</a>
        </div>`;
      showDiag(`Succeeded with provider: ${provider}`);
      saveHistory(input.value.trim(), shortUrl);
    }

    function showDiag(text){ diag.style.display='block'; diag.textContent = text }

    function saveHistory(original, shorty){
      try{
        const arr = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
        arr.unshift({original, shorty, at: Date.now()});
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr.slice(0,10)));
        renderHistory();
      }catch(e){ console.warn(e) }
    }

    function renderHistory(){
      const arr = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
      historyList.innerHTML = '';
      if(!arr.length){ historyList.innerHTML = '<div class="mini">No links yet</div>'; return }
      arr.forEach(it => {
        const d = document.createElement('div'); d.className='item';
        d.innerHTML = `<div><div class="mini">${it.original}</div><a href="${it.shorty}" target="_blank" rel="noopener">${it.shorty}</a></div>
          <div style="display:flex;gap:8px"><button class="btn" onclick="copyLink('${it.shorty}')">Copy</button><a class="btn" href="${it.shorty}" target="_blank" rel="noopener">Open</a></div>`;
        historyList.appendChild(d);
      })
    }

    async function tryFetch(url){
      const r = await fetch(url, { method: 'GET' });
      const text = await r.text().catch(()=>'');
      return { ok: r.ok, status: r.status, text };
    }

    async function shorten(){
      const normalized = normalizeUrl(input.value);
      result.textContent=''; diag.style.display='none';
      if(!normalized){ showError('Please enter a valid URL.'); return; }
      setWorking(true);
      let lastErr = '';
      try{
        for(const p of providers){
          showDiag(`Trying provider: ${p.name} ...`);
          try{
            const api = p.build(normalized);
            const res = await tryFetch(api);
            console.log(p.name, res);
            if(res.ok){
              const text = (res.text||'').trim();
              // is.gd/v.gd/tinyurl return a short url as plain text on success, or an error string
              if(!text || text.toLowerCase().startsWith('error')){
                lastErr = `${p.name} returned error text: ${text || '[empty]'}`;
                continue; // try next
              }
              showSuccess(text, p.name);
              return;
            } else {
              lastErr = `${p.name} HTTP ${res.status} ${res.text ? '- ' + (res.text.slice(0,200)) : ''}`;
              continue;
            }
          }catch(fetchErr){
            console.error('fetch failed for', p.name, fetchErr);
            lastErr = `${p.name} fetch error: ${fetchErr.message || fetchErr}`;
            continue;
          }
        }
        // all failed
        showError('Could not shorten URL. Try again.', `All providers failed. Last: ${lastErr}.\nHints: 1) Make sure you are on HTTPS (GitHub Pages). 2) Disable browser extensions/adblockers. 3) Try a different URL (for example https://example.com). 4) Open DevTools -> Network to inspect requests.`);
      }finally{ setWorking(false); }
    }

    btn.addEventListener('click', shorten);
    input.addEventListener('keydown', e => { if(e.key === 'Enter') shorten(); });
    clearBtn.addEventListener('click', ()=>{ input.value=''; result.textContent=''; diag.style.display='none'; });

    window.copyLink = async function(text){
      try{ await navigator.clipboard.writeText(text); alert('Copied to clipboard'); }
      catch{ const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); alert('Copied'); }
    }

    renderHistory();
  </script>
</body>
</html>
